# ドメインモデル

この資料では、システムのドメインモデルを定義します。ドメイン駆動設計（DDD）の原則に従い、ユビキタス言語とドメインの境界を明確にします。

システムは以下の境界づけられたコンテキストに分割されます。

## 1. アカウント管理コンテキスト

### ユビキタス言語

| 用語 | 定義 |
|------|------|
| ユーザー | システムを利用する人。認証情報と権限を持つ。 |
| DID | Blueskyで使用される分散型識別子。ユーザーの一意な識別子として使用。 |
| 認証 | ユーザーの身元を確認するプロセス。Bluesky SSOを使用。 |
| 認可 | ユーザーが特定の操作を実行する権限を持っているかを確認するプロセス。 |
| 連携 | ユーザーとGitHubアカウントの紐付け。GitHub Appsを使用。 |
| インストール | GitHub Appsをユーザーのリポジトリにインストールするプロセス。 |

### 責務

- ユーザー認証と認可を管理
- BlueskyのSSOを利用したアカウント連携
- GitHubとの連携設定

### エンティティ

- User（ユーザー）

### 集約

- ユーザー集約
  - ルートエンティティ: User
  - 責務: ユーザー情報とアカウント連携の管理

### サービス

- 認証サービス
  - Bluesky SSOによる認証処理
  - GitHub Appsの認証と連携

## 2. 文書管理コンテキスト

### ユビキタス言語

| 用語 | 定義 |
|------|------|
| 文書 | Markdownで記述されたコンテンツ。GitHubリポジトリで管理される。 |
| 執筆者 | 文書を作成・編集する人。GitHubリポジトリの所有者または協力者。 |
| リポジトリ | GitHubで管理される文書の集合体。文書の出所となる。 |
| パス | リポジトリ内での文書の場所を示す識別子。 |
| タグ | 文書を分類するためのキーワード。複数の文書に付与可能。 |
| 同期 | GitHubリポジトリから文書を取得し、システムに反映するプロセス。 |
| Webhook | GitHubの変更を検知し、自動的に同期を開始するトリガー。 |
| 公開スコープ | 文書の公開範囲を指定する設定（公開/限定公開/非公開）。 |

### 責務

- GitHubからの文書取得
- 文書の解析と保存
- 文書のバージョン管理
- タグの管理と文書の分類

### エンティティ

- Document（文書）
- Repo（GitHubリポジトリ）
- Tag（タグ）

### 集約

- 文書集約
  - ルートエンティティ: Document
  - 関連エンティティ: GitHubRepo, Tag
  - 責務: 文書の管理とバージョン追跡
- タグ集約
  - ルートエンティティ: Tag
  - 責務: 文書の分類と検索の効率化

### サービス

- 同期サービス
  - GitHubからの文書取得
  - Markdownの解析と処理
  - データベースへの保存
- タグ管理サービス
  - タグの作成と管理
  - 文書へのタグ付与と削除
  - タグベースの文書検索

## 3. 投稿管理コンテキスト

### ユビキタス言語

| 用語 | 定義 |
|------|------|
| 投稿 | 文書をBlueskyに公開したもの。URIで識別される。 |
| 投稿者 | Blueskyに投稿を行うユーザー。 |
| 公開 | 文書をBlueskyに投稿するプロセス。 |
| URI | Bluesky上での投稿の一意な識別子。 |
| 状態 | 投稿の現在の状況（保留中/公開済み/失敗）。 |
| エラー | 投稿プロセス中に発生した問題の記録。 |

### 責務

- Blueskyへの投稿処理
- 投稿メタデータの管理
- 投稿の状態追跡

### エンティティ

- Post（投稿）

### 集約

- 投稿集約
  - ルートエンティティ: Post
  - 責務: Blueskyへの投稿状態の管理

### サービス

- 投稿サービス
  - Bluesky APIを使用した投稿処理
  - 投稿状態の追跡と管理

## 4. 表示コンテキスト

### ユビキタス言語

| 用語 | 定義 |
|------|------|
| 閲覧者 | 文書を閲覧するユーザー。 |
| レンダリング | Markdownを視覚的に表示可能な形式に変換するプロセス。 |
| メタデータ | 文書に関連する付加情報（タグ、投稿状態など）。 |
| インタラクション | ユーザーが文書やシステムと対話する方法。 |
| ナビゲーション | 文書間や機能間を移動する手段。 |

### 責務

- 文書のレンダリング
- ユーザーインターフェース
- インタラクション管理

### エンティティ

- なし（表示コンテキストは主に他のコンテキストのエンティティを表示する）

### 集約

- なし

### サービス

- 表示サービス
  - Markdownのレンダリング
  - メタデータの表示
  - インタラクションの処理

## コンテキストマップ

異なるコンテキスト間での用語の関係を以下に示します：

| コンテキストA | 用語A | コンテキストB | 用語B | 関係 |
|--------------|-------|--------------|-------|------|
| アカウント管理 | ユーザー | 文書管理 | 執筆者 | 同一エンティティの異なる側面。ユーザーが文書を作成する場合に執筆者となる。 |
| アカウント管理 | ユーザー | 投稿管理 | 投稿者 | 同一エンティティの異なる側面。ユーザーが投稿を行う場合に投稿者となる。 |
| アカウント管理 | ユーザー | 表示コンテキスト | 閲覧者 | 同一エンティティの異なる側面。ユーザーが文書を閲覧する場合に閲覧者となる。 |
| 文書管理 | 文書 | 投稿管理 | 投稿 | 文書が投稿プロセスを経て投稿となる。投稿は文書の公開状態を表す。 |
| 文書管理 | 公開スコープ | 投稿管理 | 状態 | 公開スコープが「公開」の場合、投稿状態が「公開済み」になる可能性がある。 |
| 文書管理 | 文書 | 表示コンテキスト | レンダリング | 文書がレンダリングプロセスを経て表示される。 |