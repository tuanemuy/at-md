# ドメインモデル概要

この資料では、システム全体のドメインモデルの概要を説明します。ドメイン駆動設計（DDD）の原則に従い、システムは複数の境界づけられたコンテキストに分割されています。

## 境界づけられたコンテキスト

システムは以下の境界づけられたコンテキストに分割されます：

### 1. アカウント管理コンテキスト

- ユーザー認証と認可を管理
- BlueskyのSSOを利用したアカウント連携
- GitHubとの連携設定
- ユーザー情報の取得
- [詳細説明](./account.md)
- [型定義](../domain-types/account.md)

### 2. ノート管理コンテキスト

- GitHubからのノート取得
- ノートの保存
- ブックの管理
- タグの管理
- [詳細説明](./note.md)
- [型定義](../domain-types/note.md)

### 3. 投稿管理コンテキスト

- Blueskyへの投稿処理
- 投稿の状態追跡
- エンゲージメント情報の取得
- [詳細説明](./post.md)
- [型定義](../domain-types/post.md)

## コンテキストマップ

異なるコンテキスト間での用語の関係を以下に示します：

| コンテキストA | 用語A | コンテキストB | 用語B | 関係 | 連携パターン |
|--------------|-------|--------------|-------|------|------------|
| アカウント管理 | ユーザー | ノート管理 | 執筆者 | 同一エンティティの異なる側面。ユーザーがノートを作成する場合に執筆者となる。 | 共有カーネル |

各コンテキスト間の連携パターンを明示することで、実装時の依存関係が明確になります。

## 不変条件

各コンテキストで守られるべき不変条件を定義します：

### アカウント管理コンテキスト

- ユーザーのDIDは一意でなければならない
- GitHub連携情報は特定のユーザーに紐づいていなければならない

### ノート管理コンテキスト

- ノートは必ず1つのブックに属する
- ブックは必ず1人のユーザーに属する
- タグ名は一意でなければならない

### 投稿管理コンテキスト

- 投稿は必ず1つのノートに紐づく
- 投稿は必ず1人のユーザーによって行われる

## 型定義との連携

各コンテキストのドメインモデルは、対応する型定義ファイルで詳細に定義されています。型定義ファイルは、ドメインモデルの実装時に参照するための設計ドキュメントとして機能します。 

- [型定義ディレクトリ](../domain-types)
- [共通型定義](../domain-types/common.md)

## コンテキスト間の連携

コンテキスト間の連携は、契約（contracts）を通じて行います。各コンテキストは、他のコンテキストが利用できるインターフェースを公開します。

```typescript
// アカウントコンテキスト
import { ID } from '@/domain/shared/models/id';

export interface UserReference {
  id: ID;
  name: string;
  did: string;
}

export interface UserService {
  getUserReference(userId: ID): Promise<Result<UserReference, Error>>;
}

// ノート管理コンテキスト
import { ID } from '@/domain/shared/models/id';
import { UserReference } from '@/domain/account/contracts';

export interface Note {
  id: ID;
  title: string;
  content: string;
  author: UserReference; // アカウントコンテキストからの参照
  // ...
}
```
